(function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty,e=function(a,b){return function(){return a.apply(b,arguments)}};a=window.jQuery,b=window.gifdropApp={init:function(){return this.$window=a(window),this.settings=gifdropSettings,this.settings.canUpload="1"===this.settings.canUpload,this.$wrapper=a("body > #outer-wrapper"),this.$modal=a("body > #modal"),this.setGifWidthCSS(),this.images=new this.Images(_.toArray(this.settings.attachments)),this.modalView=new b.ModalView({collection:this.images}),this.modalView.render(),this.$modal.replaceWith(this.modalView.el),this.modalView.views.ready(),this.view=new this.MainView({collection:this.images}),this.view.render(),this.$wrapper.html(this.view.el),this.view.views.ready(),this.$browser=a(".browser"),this.modalView.listenTo(this.modalView,"modalOpen",function(){return a("body").addClass("modal-open")}),this.modalView.listenTo(this.modalView,"modalClosed",function(){return a("body").removeClass("modal-open"),a("input.search").focus()}),this.initUploads()},setGifWidthCSS:function(){var b,c;return c=this.$window.width(),this.smallMobile=640>c,b=this.smallMobile?2:Math.ceil(c/320),this.imageWidth=Math.floor(c/b),a("head").append("<style>.gif { width: "+this.imageWidth+"px; }</style>")},initUploads:function(){var c,d,e,f,g;return d=function(){},e=function(){return a("body").addClass("uploading")},c=function(){return alert("error")},f=function(c){var d,e,f,g;return a("body").removeClass("uploading"),d=c.attributes,e=d.sizes.full,g=d.sizes["full-gif-static"]||e,f={id:c.id,width:e.width,height:e.height,title:d.title,src:e.url,"static":g.url},b.images.add(f,{at:0})},g=new wp.Uploader({container:this.$wrapper,browser:this.$browser,dropzone:this.$wrapper,success:f,error:c,params:{post_id:this.settings.id,provide_full_gif_static:!0},supports:{dragdrop:!0},plupload:{runtimes:"html5",filters:[{title:"Image",extensions:"jpg,jpeg,gif,png"}]}}),g.supports.dragdrop?(g.uploader.bind("BeforeUpload",e),g.uploader.bind("UploadProgress",d)):(g.uploader.destroy(),g=null)},restrictHeight:function(a,b){return b>1.5*a?1.5*a:b},fitTo:function(a,b,c){var d;return d=b/a,[c,Math.round(c*d)]},sync:function(a){return a=_.defaults(a||{},{context:this}),a.data=_.defaults(a.data||{},{action:"gifdrop",post_id:this.settings.id,_ajax_nonce:this.settings.nonce}),wp.ajax.send(a)}},b.View=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.render=function(){var a;return a=b.__super__.render.apply(this,arguments),"function"==typeof this.postRender&&this.postRender(),a},b.prototype.prepare=function(){var a;return null!=(a=this.model)&&"function"==typeof a.toJSON?a.toJSON():void 0},b}(wp.Backbone.View),b.BrowserView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.className="browser",b}(wp.Backbone.View),b.Image=function(a){function d(){return this.setImageDims=e(this.setImageDims,this),d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.initialize=function(){return this.setImageDims()},d.prototype.setImageDims=function(){var a,c,d;return c=b.fitTo(this.get("width"),this.get("height"),b.imageWidth),d=c[0],a=c[1],this.set({imgWidth:d,divHeight:b.restrictHeight(d,a),imgHeight:a})},d.prototype._sync=function(a,c){return b.sync({context:this,success:c.success,error:c.error,data:a})},d.prototype.sync=function(a,b,c){var d;return"update"===a?(d={subaction:a,model:JSON.stringify(b.toJSON())},this._sync(d,c)):void 0},d}(Backbone.Model),b.ImageContainer=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.model=b.Image,d}(Backbone.Collection),b.Images=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.initialize=function(a){var c,d;return c=function(){var c,e,f;for(f=[],c=0,e=a.length;e>c;c++)d=a[c],f.push(new b.Image(d));return f}(),this.filtered=new b.ImageContainer(c),this.listenTo(this.filtered,"change",this.changeMain)},d.prototype.changeMain=function(a){return this.get(a.get("id")).set(a.toJSON())},d.prototype._findGifs=function(a){var b,c,d,e;return a.length>2?(e=_.map(a.split(/[ _-]/),function(a){return a.toLowerCase()}),b=_.last(e),d=this.filter(function(a){var c,d,f;return f=_.map(a.get("title").split(/[ _-]/),function(a){return a.toLowerCase()}),c=function(){var a,c,g;for(g=[],a=0,c=e.length;c>a;a++)d=e[a],g.push(function(a){var c,d,e,g,h,i,j,k,l;for(j=function(){var a,b,c,d;for(c=["s","es","ing"],d=[],a=0,b=c.length;b>a;a++)k=c[a],d.push(new RegExp(k+"$"));return d}(),d=0,g=f.length;g>d;d++){if(l=f[d],c=!1,b===a&&(c=0===l.indexOf(b)),!c)for(c=l===a,e=0,h=j.length;h>e;e++)i=j[e],c||(c=l+k===a),c||(c=l===a+k),c||(c=l.replace(i,"")===a),c||(c=l===a.replace(i,""));if(c)return c}}(d));return g}(),c=_.filter(c,function(a){return a}),c.length===e.length}),c={}):(d=this.models,c={all:!0}),[d,c]},d.prototype.findGifs=function(a){var b,c,d;return null==this.memoizedFindGifs&&(this.memoizedFindGifs=_.memoize(this._findGifs)),c=this.memoizedFindGifs(a),d=c[0],b=c[1],_.isEqual(this.filtered.pluck("id"),_.pluck(d,"id"))?void 0:this.filtered.reset(d,b)},d}(b.ImageContainer),b.MainView=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.className="wrapper",d.prototype.initialize=function(){return this.views.add(new b.ImageNavView({collection:this.collection})),this.views.add(new b.ImagesListView({collection:this.collection})),this.views.add(new b.BrowserView)},d}(b.View),b.ImageNavView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.className="nav",b.prototype.template=wp.template("nav"),b.prototype.events={"keyup input.search":"search"},b.prototype.lastSearch="",b.prototype._search=function(a){return this.collection.findGifs(a)},b.prototype.search=function(a){return 27===a.which&&this.$search.val(""),null==this.debouncedSearch&&(this.debouncedSearch=_.debounce(this._search,500)),this.debouncedSearch(this.$search.val())},b.prototype.postRender=function(){return this.$search=this.$("input.search")},b.prototype.ready=function(){return this.$search.focus()},b}(b.View),b.ImagesListEmptyView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.className="gifs-empty",b.prototype.template=wp.template("empty"),b.prototype.initialize=function(){return this.listenTo(this.collection,"add",this.remove)},b}(b.View),b.ImagesListView=function(d){function f(){return this.masonry=e(this.masonry,this),this.pauseMasonry=e(this.pauseMasonry,this),f.__super__.constructor.apply(this,arguments)}return c(f,d),f.prototype.className="gifs",f.prototype.windowWidth=0,f.prototype.initialize=function(){return this.windowWidth=a(window).width(),this.setSubviews(),this.listenTo(this.collection,"add",this.addNew),this.listenTo(this,"newView",this.animateItemIn),this.listenTo(this.collection.filtered,"reset",this.filterIsotope)},f.prototype.animateItemIn=function(a,b){var c,d;if(d=this.collection.filtered.indexOf(a),c=this.collection.filtered.length-1,this.$el.data("isotope"))switch(d){case 0:return this.$el.isotope("prepended",b);case c:return this.$el.isotope("appended",b);default:return this.$el.isotope("reloadItems").isotope()}},f.prototype.addNew=function(a,b,c){return this.addView(a,{at:null!=c?c.at:void 0})},f.prototype.addView=function(a,c){var d;return d=new b.ImageListView({model:a}),this.views.add(d,c)},f.prototype.filterIsotope=function(b,c){var d,e,f,g,h,i;for(a("body").animate({scrollTop:0},200),f=b.pluck("id"),d=(null!=c?c.all:void 0)?function(){return!0}:function(){return _.contains(_.chain(f).map(function(a){return"gif-"+a}).value(),a(this).attr("id"))},h=this.views.get(),e=0,g=h.length;g>e;e++)i=h[e],_.contains(f,i.model.get("id"))&&i.trigger("loadImage");return this.$el.isotope({filter:d})},f.prototype.setSubviews=function(){var a;return a=_.map(this.collection.models,function(a){return new b.ImageListView({model:a})}),a.length?this.views.set(a):b.settings.canUpload?this.views.add(new b.ImagesListEmptyView({collection:this.collection})):void 0},f.prototype.resize=function(){return this.windowWidth!==a(window).width()?(this.pauseMasonry(),b.setGifWidthCSS(),this.trigger("resize"),this.masonry(),this.windowWidth=a(window).width()):void 0},f.prototype.ready=function(){return a(function(a){return function(){return a.masonry()}}(this)),a(window).on("resize",this.pauseMasonry),a(window).on("resize",_.debounce(_.bind(this.resize,this),500))},f.prototype.pauseMasonry=function(){return this.windowWidth!==a(window).width()&&(this.windowWidth=0,this.$el.hide(),this.$el.data("isotope"))?this.$el.isotope("destroy"):void 0},f.prototype.masonry=function(){return this.$el.show(),this.$el.isotope({layoutMode:"masonry",itemSelector:".gif",transitionDuration:"300ms",visibleStyle:{opacity:1},hiddenStyle:{opacity:0},sortBy:"original-order",masonry:{columnWidth:b.imageWidth,gutter:0}}),a("html").scroll()},f}(b.View),b.ImageListView=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.className="gif",d.prototype.template=wp.template("gif"),d.prototype.events={mouseover:"mouseover",mouseout:"mouseout",click:"click"},d.prototype.initialize=function(){return this.listenTo(this,"loadImage",this.loadImage),this.listenTo(this.model,"change:divHeight",this.crop)},d.prototype.attributes=function(){return{id:"gif-"+this.model.get("id")}},d.prototype.mouseover=function(){return this.$img.attr({src:this.model.get("src")}),this.unCrop()},d.prototype.mouseout=function(){return this.$img.attr({src:this.model.get("static")}),this.restoreCrop()},d.prototype.click=function(){var a;return b.smallMobile?window.location.href=this.model.get("src"):(a=new b.SingleView({model:this.model}),b.modalView.open(),b.modalView.views.set(a),this.mouseout())},d.prototype.unCrop=function(){var a,b,c;return this.model.get("imgHeight")!==this.model.get("divHeight")?(c=this.model.get("imgWidth")/this.model.get("imgHeight"),b=this.model.get("divHeight")*c,a=this.model.get("imgWidth")-b,this.$el.css({padding:"0 "+a/2+"px"})):void 0},d.prototype.restoreCrop=function(){return this.model.get("imgHeight")!==this.model.get("divHeight")?this.$el.css({padding:0,"z-index":"auto"}):void 0},d.prototype.crop=function(){return this.$el.css({height:this.model.get("divHeight")+"px"})},d.prototype.loadImage=function(){return this.$img.trigger("appear")},d.prototype.postRender=function(){return this.crop(),this.$img=this.$("> img")},d.prototype.ready=function(){return this.listenTo(this.views.parent,"resize",this.model.setImageDims),this.$img.show().lazyload(),this.views.parent.trigger("newView",this.model,this.$el)},d}(b.View),b.ModalView=function(b){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.attributes={id:"modal"},d.prototype.events={click:"click","click a.dashicons-dismiss":"clickClose"},d.prototype.keyup=function(a){return 27===a.which?this.close():void 0},d.prototype.open=function(){return this.$el.show().addClass("open"),this.trigger("modalOpen")},d.prototype.close=function(){return this.$el.hide().removeClass("open"),this.trigger("modalClosed")},d.prototype.clickClose=function(a){return a.preventDefault(),this.close()},d.prototype.click=function(a){var b,c,d,e;if(this.el===a.target){for(d=this.views.get(),b=0,c=d.length;c>b;b++)e=d[b],e.trigger("modalClosing:click");return this.close()}},d.prototype.ready=function(){return a("body").on("keyup",function(a){return function(b){return 27===b.which?a.close():void 0}}(this))},d}(b.View),b.SingleView=function(d){function f(){return this.clipboardFallback=e(this.clipboardFallback,this),this.alertCopied=e(this.alertCopied,this),this.resize=e(this.resize,this),f.__super__.constructor.apply(this,arguments)}return c(f,d),f.prototype.template=wp.template("single"),f.prototype.className="modal-content",f.prototype.events={"keyup input.title":"keyup","click input.copy":"selectURL","click img":"selectURL"},f.prototype.initialize=function(){return this.listenTo(this,"modalClosing:click",this.save),this.copyButton=null,this.buttonClipboard=null,this.imgClipboard=null},f.prototype.prepare=function(){var a;return a=f.__super__.prepare.apply(this,arguments),a.canUpload=b.settings.canUpload,a},f.prototype.save=function(){return this.model.set({title:this.$title.val()}),this.model.save()},f.prototype.keyup=function(a){return 13===a.which&&(this.save(),this.views.parent.close()),27===a.which?(this.$title.val(this.model.get("title")),this.views.parent.close()):void 0},f.prototype.resize=function(){return this.$contentInner.css({height:_.min([a(window).height()-120,this.model.get("height")+130])+"px"})},f.prototype.alertCopied=function(){return this.$copyButton.html(this.$copyButton.data("copied-message"))},f.prototype.selectURL=function(){return this.$copyInput.is(":visible")?this.$copyInput.prop("readonly",!1).select().prop("readonly",!0):void 0},f.prototype.clipboardFallback=function(){return this.$copyButton.hide(),this.$copyInput.show()},f.prototype.postRender=function(){return this.$title=this.$("input.title"),this.$contentInner=this.$(".modal-content-inner"),this.$clipboardWrap=this.$contentInner.find(".copy-to-clipboard"),this.$copyButton=this.$contentInner.find("button.copy"),this.$copyInput=this.$contentInner.find("input.copy"),this.$copyButton.css({width:this.model.get("width")}),this.clipboard=new ZeroClipboard(this.$clipboardWrap.get(0)),this.clipboard.on("aftercopy",this.alertCopied),this.clipboard.on("error",this.clipboardFallback),this.resize()},f.prototype.ready=function(){return b.settings.canUpload?this.$title.focus().val(this.$title.val()):this.$copyInput.is(":visible")&&this.selectURL(),a(window).on("resize",_.throttle(this.resize,50))},f}(b.View)}).call(this);
//# sourceMappingURL=gifdrop.min.js.map